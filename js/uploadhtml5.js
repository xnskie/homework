var text={uploadingButton:{ru:"...загрузка...",en:"...uploading..."},enterNameLabel:{ru:"Введите имя презентации",en:"Enter presentation name"},uploadButton:{ru:"Залить",en:"Upload"},complete:{ru:"Конвертация завершена",en:"Conversion completed"},errUnconvertable:{ru:"Не удалось отобразить презентацию",en:"Unable to display the presentation"},errUnconvertable:{ru:"Не удалось отобразить презентацию",en:"Unable to display the presentation"},errAlreadyConverting:{ru:"Еще конвертируется. Обновите страницу через пять минут",en:"Already converting. Try to refresh the page after 3 minutes"},errUploadError:{ru:"При загрузке возникла ошибка",en:"Error uploading"},converting:{ru:"Конвертация...",en:"converting..."},tooBig:{ru:"Слишком большая!",en:"Too big!"},uploadAborted:{ru:"Загрузка отменена",en:"Upload canceled"}};function showUploadDialog(){return console.log("upfile"),document.getElementById("uploadedfile").click(),!1}function submitAll(e){console.log("submit"),$("#up").val(text.uploadingButton[sitelang]),$("#up").css("color","black"),$("#up").attr("disabled","disabled"),$("#warn").css("display",""),$("#progressBar").css("display","block");var t=document.getElementById("uploadedfile").files[0],n=new FormData;n.append("uploadedfile",t),n.append("action","upload"),n.append("nicename",document.getElementById("nicename").value);var o=new XMLHttpRequest;o.upload.addEventListener("progress",progressHandler,!1),o.addEventListener("load",completeHandler,!1),o.addEventListener("error",errorHandler,!1),o.addEventListener("abort",abortHandler,!1),o.open("POST","//cf4.ppt-online.org/"),o.withCredentials=!0,o.send(n)}function progressHandler(e){var t=Math.round(e.loaded/e.total*100);document.getElementById("status").style.width=t+"%",t<90?document.getElementById("textStatus").innerHTML=t+"%":(document.getElementById("status").style.width="100%",document.getElementById("textStatus").innerHTML=text.converting[sitelang],$("#status").addClass("active"))}function completeHandler(e){var t=parseInt(e.target.responseText);console.log(t),t>0?(document.getElementById("textStatus").innerHTML=text.complete[sitelang],window.location.href=t):document.getElementById("textStatus").innerHTML=0==t?'<span style="color:red;">'+text.errUnconvertable[sitelang]+"</span>":-2==t?'<span style="color:red;">'+text.errAlreadyConverting[sitelang]+"</span>":'<span style="color:red;">'+text.errUploadError[sitelang]+"</span>",reinitButtons()}function errorHandler(e){document.getElementById("textStatus").innerHTML=text.errUploadError[sitelang]}function abortHandler(e){document.getElementById("textStatus").innerHTML=text.uploadAborted[sitelang]}function reinitButtons(){$("#up").removeAttr("disabled"),$("#up").val(text.uploadButton[sitelang]),$("#up").css("display","none"),$("#chooseButton").css("display","inline-block"),$("#nicename").val(""),$("#status").removeClass("active")}function loadLazy(){$(".lazy-thumb").each((function(){$(this).attr("src",$(this).data("src"))}))}function initLazy(){var e=$("#pptInfoPanel").height();e||(e=200),$(window).on("scroll",(function(){scrollPosition=$(this).scrollTop(),scrollPosition>=e&&($(this).off("scroll"),loadLazy())})),(document.documentElement.scrollTop||document.body.scrollTop)>=e&&loadLazy()}function initSearchPanelButton(){$("#searchCaller").click((function(){$("#searchContainer").toggle(100),$(".searchText").toggle(100),$("#searchCaller").toggle(100),$("#searchInput").focus()}))}function initLazyTab(){$(".nav-tabs a").on("show.bs.tab",(function(e){$($(e.target).attr("href")).find(".lazy-tab").each((function(){$(this).attr("src",$(this).data("src"))}))}))}$(document).ready((function(){initLazy(),initLazyTab(),reinitButtons(),initSearchPanelButton(),$("#progressBar").css("display","none"),$("#uploadedfile").change((function(e){var t=$("#uploadedfile").val(),n=document.getElementById("uploadedfile").files[0];if(console.log(n.size),n.size>6e7)return $("#label").html('<span style="color:red;">'+text.tooBig[sitelang]+"</span>"),!1;var o=t.lastIndexOf("\\"),a=(t=t.substr(o+1,t.length-o)).lastIndexOf("."),r=t.substr(0,a)||t,l=t.substr(a+1,t.length-a);console.log(l),$("#progressBar").css("display","none"),$("#nicename").val(r),$("#nicename").removeAttr("readonly"),$("#nicename").focus(),$("#label").html("<b>"+text.enterNameLabel[sitelang]+":</b>"),$("#chooseButton").css("display","none"),$("#up").css("display",""),$("#up").removeAttr("disabled")}))}));